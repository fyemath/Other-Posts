<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scaling and Centering Figures for Rmarkdown | </title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link href="/css/customized.css" type="text/css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>

<script src="/js/thm-numbering.js"></script>
<script src="/js/article-meta-height.js"></script>
<script src="/js/background-by-season.js"></script>


<link href="/css/syntax.css" type="text/css" rel="stylesheet"/>

<link href="/css/fonts-en-cn.css" type="text/css" rel="stylesheet"/>

<link href="/css/css-doodle.css" type="text/css" rel="stylesheet"/>
<script src="https://unpkg.com/css-doodle@0.13.2/css-doodle.min.js"></script>



<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-regular.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-regular.woff" type="font/woff" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-italic.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-italic.woff" type="font/woff" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-700.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-700.woff" type="font/woff" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-700italic.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans/noto-sans-v11-latin_greek-700italic.woff" type="font/woff" crossorigin="anonymous">



<link rel="preload" as="font" href="/css/fonts/noto-sans-sc/noto-sans-sc-v12-chinese-simplified-regular.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans-sc/noto-sans-sc-v12-chinese-simplified-regular.woff" type="font/woff" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans-sc/noto-sans-sc-v12-chinese-simplified-700.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-sans-sc/noto-sans-sc-v12-chinese-simplified-700.woff" type="font/woff" crossorigin="anonymous">

<link rel="preload" as="font" href="/css/fonts/noto-serif-sc/noto-serif-sc-v8-chinese-simplified-regular.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-serif-sc/noto-serif-sc-v8-chinese-simplified-regular.woff" type="font/woff" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-serif-sc/noto-serif-sc-v8-chinese-simplified-700.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/css/fonts/noto-serif-sc/noto-serif-sc-v8-chinese-simplified-700.woff" type="font/woff" crossorigin="anonymous">





<script>
  $(':root').css('--header-height', '0 px');

  $(document).ready(divHeight);
  $(window).on('resize', divHeight);

  function divHeight() {
    var dheight = $(".header h1").outerHeight(true)  + "px";
    document.documentElement.style.setProperty('--header-height', dheight);
  }
</script>

  </head>

  

  <body class="en">
    <nav>
    <ul class="menu">
    
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/en/">Blog</a></li>
      
      <li><a href="/en/categories/">Categories</a></li>
      
      <li><a href="/en/tags/">Tags</a></li>
      
      <li><a href="/cn/">中文</a></li>
      
    </ul>
    </nav>
    <hr/>




<div class="page">

<div class="article-title">
  <css-doodle use="var(--rule)" as-bg="" click-to-update=""></css-doodle>
  <div class="article-meta">
    <h1><span class="title">Scaling and Centering Figures for Rmarkdown</span></h1>
    <h2 class="author">
    
        Fei Ye
    
    </h2>
    <h3 class="date">2020/03/12</h3>
  </div>
</div>

<main>
<p>There are different ways to include a picture in Rmarkdown. The basic way is to use <code>![caption](path/to/picture.extension)</code>. If the figure is not in an bookdown theorem environment, you may also use <code>knitr</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="n">```{r figure, echo=FALSE}
</span><span class="n">knitr::include_graphics(path/to/picture.extension)
</span><span class="n">```</span>
</code></pre></div><p>The way using <code>knitr</code> to include graphics provide more options to control the dimension and position of a figure. For details, you may read <a href="https://yihui.org/knitr/options/#plots">Yihui&rsquo;s knitr manual on plots</a>.</p>
<p>Because I normally have to include pictures in theorem environment in bookdown. The <code>knitr</code> function is not an option for me to include a picture. However, that&rsquo;s not the end. We only need some external tools to get what we want.</p>
<h2 id="centering-and-scaling-for-html-output">Centering and Scaling for HTML Output</h2>
<p>To center and change the dimension globally for pictures for the html output, we may add the following css code chunk at the beginning of your Rmarkdown file.</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="err">```</span><span class="p">{</span><span class="err">css,</span> <span class="err">include=FALSE</span><span class="p">}</span>
<span class="nt">img</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span><span class="mi">60</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">max-width</span><span class="p">:</span><span class="mi">360</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">```</span>
</code></pre></div><h2 id="centering-and-scaling-for-pdf-output">Centering and Scaling for PDF Output</h2>
<p>For PDF (using TeX) output, to change dimension, first you need create a tex file, say <code>preamble.tex</code>, and add the following into it.</p>
<div class="highlight"><pre class="chroma"><code class="language-latex" data-lang="latex"><span class="k">\usepackage</span><span class="nb">{</span>graphicx<span class="nb">}</span>
<span class="c">%The following codes scale images in mainmatter if necessary
</span><span class="c">%It will be overwrite by local setting in \includegraphics[width, height, ...]{}
</span><span class="c"></span><span class="k">\makeatletter</span>
<span class="k">\def\maxwidth</span><span class="nb">{</span><span class="k">\ifdim\Gin</span>@nat@width&gt;<span class="k">\textwidth</span> <span class="k">\textwidth\else\Gin</span>@nat@width<span class="k">\fi</span><span class="nb">}</span>
<span class="k">\def\maxheight</span><span class="nb">{</span><span class="k">\ifdim\Gin</span>@nat@height&gt;0.5<span class="k">\textheight</span> 0.5<span class="k">\textheight\else\Gin</span>@nat@height<span class="k">\fi</span><span class="nb">}</span>
<span class="k">\makeatother</span>
<span class="k">\setkeys</span><span class="nb">{</span>Gin<span class="nb">}{</span>width=<span class="k">\maxwidth</span>,height=<span class="k">\maxheight</span>,keepaspectratio<span class="nb">}</span>
<span class="c">%The following codes add max dimension options to includegraphics
</span><span class="c"></span><span class="k">\usepackage</span><span class="na">[export]</span><span class="nb">{</span>adjustbox<span class="nb">}</span> <span class="c">%Needed for max width
</span><span class="c"></span><span class="k">\usepackage</span><span class="nb">{</span>etoolbox<span class="nb">}</span> <span class="c">%Needed for \pathcmd
</span><span class="c"></span><span class="k">\expandafter\patchcmd\csname</span> Gin@ii<span class="k">\endcsname</span>
<span class="nb">{</span><span class="k">\setkeys</span><span class="nb">{</span>Gin<span class="nb">}{</span>#1<span class="nb">}}</span>
<span class="nb">{</span><span class="k">\setkeys</span><span class="nb">{</span>Gin<span class="nb">}{</span>max width=<span class="k">\textwidth</span>, max height=.5<span class="k">\textwidth</span>,keepaspectratio,#1<span class="nb">}}</span>
<span class="nb">{}</span>
<span class="nb">{}</span>
</code></pre></div><p>Then add the following to Rmarkdown yaml under the output for pdf.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">includes</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">in_header</span><span class="p">:</span><span class="w"> </span><span class="l">latex/preamble.tex</span><span class="w">
</span></code></pre></div><p>To center pictures for PDF, we need to add <code>\centering</code> to each picture environment. One way is to use <code>bookdown.post.latex</code>. An example of usage of <code>bookdown.post.latex</code> can be found in my <a href="https://fy-blog.netlify.com/en/2020/02/clean-latex-commands/">previous post</a>. Another way, which works better is to use a pandoc lua filter. First, you need create a file, add the following codes and save as a <code>.lua</code> file, say <code>latex.lua</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="kr">function</span> <span class="nf">Image</span> <span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">el.classes</span><span class="p">:</span><span class="n">includes</span><span class="p">(</span><span class="s2">&#34;center&#34;</span><span class="p">)</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="p">{</span>
      <span class="n">pandoc.RawInline</span><span class="p">(</span><span class="s1">&#39;latex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">hfill</span><span class="se">\\</span><span class="s1">break{</span><span class="se">\\</span><span class="s1">centering&#39;</span><span class="p">),</span>
      <span class="n">el</span><span class="p">,</span>
      <span class="n">pandoc.RawInline</span><span class="p">(</span><span class="s1">&#39;latex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">par}&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="kr">end</span>
<span class="kr">end</span>
</code></pre></div><p>Then add the following option to the Rmarkdown YAML under the output for pdf.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">pandoc_args</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;--lua-filter=latex/latex.lua&#34;</span><span class="w">
</span></code></pre></div>
</main>


  <hr>
  <p class="update"> Edited on 2020/07/19</p>
  <hr>


<section class="comments">
  <script src="https://utteranc.es/client.js"
  repo="fyemath/Other-blogs-comments"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
</section>


</div>

<hr>
  <footer>
  
  © <a href="https://yfei.page">Fei Ye</a> 2018-2020 | <a href="https://github.com/fyemath">Github</a>
  
  </footer>
  </body>
  


<script src="/js/check-for-tex.js" defer></script>
<script async src="https://yihui.org/js/center-img.js"></script>








</html>

