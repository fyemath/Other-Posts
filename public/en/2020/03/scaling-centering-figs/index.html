<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scaling and Centering Figures for Rmarkdown | </title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/customized.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
<script src="/js/thm-numbering.js"></script>

<link rel="stylesheet" href="/highlight/styles/school-book.css">
<script src="/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  </head>

  

  <body class="en">
    <nav>
    <ul class="menu">
    
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/en/">Blog</a></li>
      
      <li><a href="/en/categories/">Categories</a></li>
      
      <li><a href="/en/tags/">Tags</a></li>
      
      <li><a href="/cn/">中文</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Scaling and Centering Figures for Rmarkdown</span></h1>

<h2 class="author">

    Fei Ye

</h2>
<h2 class="date">2020/03/12</h2>
</div>

<main>
<p>There are different ways to include a picture in Rmarkdown. The basic way is to use <code>![caption](path/to/picture.extension)</code>. If the figure is not in an bookdown theorem environment, you may also use <code>knitr</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">```{r figure, echo=FALSE}
knitr::include_graphics(path/to/picture.extension)
```
</code></pre></div><p>The way using <code>knitr</code> to include graphics provide more options to control the dimension and position of a figure. For details, you may read <a href="https://yihui.org/knitr/options/#plots">Yihui&rsquo;s knitr manual on plots</a>.</p>
<p>Because I normally have to include pictures in theorem environment in bookdown. The <code>knitr</code> function is not an option for me to include a picture. However, that&rsquo;s not the end. We only need some external tools to get what we want.</p>
<h2 id="centering-and-scaling-for-html-output">Centering and Scaling for HTML Output</h2>
<p>To center and change the dimension globally for pictures for the html output, we may add the following css code chunk at the beginning of your Rmarkdown file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">```{css, include=FALSE}
img {
    img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width:60%;
    max-width:360px;
}
}
```
</code></pre></div><h2 id="centering-and-scaling-for-pdf-output">Centering and Scaling for PDF Output</h2>
<p>For PDF (using TeX) output, to change dimension, first you need create a tex file, say <code>preamble.tex</code>, and add the following into it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#66d9ef">\usepackage</span>{graphicx}
<span style="color:#75715e">%The following codes scale images in mainmatter if necessary
</span><span style="color:#75715e">%It will be overwrite by local setting in \includegraphics[width, height, ...]{}
</span><span style="color:#75715e"></span><span style="color:#66d9ef">\makeatletter</span>
<span style="color:#66d9ef">\def\maxwidth</span>{<span style="color:#66d9ef">\ifdim\Gin</span>@nat@width&gt;<span style="color:#66d9ef">\textwidth</span> <span style="color:#66d9ef">\textwidth\else\Gin</span>@nat@width<span style="color:#66d9ef">\fi</span>}
<span style="color:#66d9ef">\def\maxheight</span>{<span style="color:#66d9ef">\ifdim\Gin</span>@nat@height&gt;0.5<span style="color:#66d9ef">\textheight</span> 0.5<span style="color:#66d9ef">\textheight\else\Gin</span>@nat@height<span style="color:#66d9ef">\fi</span>}
<span style="color:#66d9ef">\makeatother</span>
<span style="color:#66d9ef">\setkeys</span>{Gin}{width=<span style="color:#66d9ef">\maxwidth</span>,height=<span style="color:#66d9ef">\maxheight</span>,keepaspectratio}
<span style="color:#75715e">%The following codes add max dimension options to includegraphics
</span><span style="color:#75715e"></span><span style="color:#66d9ef">\usepackage</span><span style="color:#a6e22e">[export]</span>{adjustbox} <span style="color:#75715e">%Needed for max width
</span><span style="color:#75715e"></span><span style="color:#66d9ef">\usepackage</span>{etoolbox} <span style="color:#75715e">%Needed for \pathcmd
</span><span style="color:#75715e"></span><span style="color:#66d9ef">\expandafter\patchcmd\csname</span> Gin@ii<span style="color:#66d9ef">\endcsname</span>
{<span style="color:#66d9ef">\setkeys</span>{Gin}{#1}}
{<span style="color:#66d9ef">\setkeys</span>{Gin}{max width=<span style="color:#66d9ef">\textwidth</span>, max height=.5<span style="color:#66d9ef">\textwidth</span>,keepaspectratio,#1}}
{}
{}
</code></pre></div><p>Then add the following to Rmarkdown yaml under the output for pdf.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">includes:
    <span style="color:#66d9ef">in_header</span>: latex/preamble.tex
</code></pre></div><p>To center pictures for PDF, we need to add <code>\centering</code> to each picture environment. One way is to use <code>bookdown.post.latex</code>. An example of usage of <code>bookdown.post.latex</code> can be found in my <a href="https://fy-blog.netlify.com/en/2020/02/clean-latex-commands/">previous post</a>. Another way, which works better is to use a pandoc lua filter. First, you need create a file, add the following codes and save as a <code>.lua</code> file, say <code>latex.lua</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Image</span> (el)
    <span style="color:#66d9ef">if</span> el.classes:includes(<span style="color:#e6db74">&#34;center&#34;</span>) <span style="color:#66d9ef">then</span>
    <span style="color:#66d9ef">return</span> {
      pandoc.RawInline(<span style="color:#e6db74">&#39;latex&#39;</span>, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">hfill</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">break{</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">centering&#39;</span>),
      el,
      pandoc.RawInline(<span style="color:#e6db74">&#39;latex&#39;</span>, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">par}&#39;</span>)
    }
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Then add the following option to the Rmarkdown YAML under the output for pdf.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">pandoc_args</span>: <span style="color:#e6db74">&#34;--lua-filter=latex/latex.lua&#34;</span>
</code></pre></div>
</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.0/es5/latest?tex-mml-chtml.js">
</script>
<script>
    MathJax = {
        tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    }
</script>
<script async src="//yihui.name/js/center-img.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

<script>
hljs.configure({languages: ["r","yaml","toml","tex","markdown"]});
</script>

<script src="/js/check-for-tex.js" defer></script>
  
  <hr/>
  © <a href="https://yfei.page">Fei Ye</a> 2019-now | <a href="https://github.com/fyemath">Github</a>
  
  </footer>
  </body>
</html>

